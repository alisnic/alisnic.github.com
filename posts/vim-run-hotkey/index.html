<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <title>Vim hotkey to run current file depending on the filetype</title>
  <meta name="author" content="Andrei Lisnic" />
  <meta name="description" content="a (instanceof) lisnic." />
  <link rel="alternate" type="application/rss+xml" href="/atom.xml" />
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png" />
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">

<link href='/assets/global-ed12576ac2a8c45d153e3d7049e3d321.css' rel='stylesheet' type='text/css' />

</head>

<body>
  <div id="wrapper">
      <!-- Sidebar -->
      <div id="sidebar-wrapper">
        <div id="avatar"></div>
        <ul class="sidebar-nav">
          <li><a href="#"><b>Andrei Lisnic</b></a></li>
          <li><a href="/" >All posts</a></li>
          <li><a href="https://github.com/alisnic" >github</a></li>
          <li><a href="https://twitter.com/andrei_lisnic" >twitter</a></li>
          <li><a href="http://www.linkedin.com/in/alisnic" >linkedin</a></li>
          <li><a href="/atom.xml" >rss</a></li>
          <li><a href="#"><b>Projects</b></a></li>
          <li><a href="/nyny/">New York, New York</a></li>
        </ul>
      </div>

      <!-- Page content -->
      <div id="page-content-wrapper">
        <div class="page-content inset">
          <div class="row">
            <div class="col-md-12">
              <script type="application/x-social-share-privacy-settings">{"path_prefix":"http://panzi.github.io/SocialSharePrivacy/","layout":"line","services":{"buffer":{"status":false},"delicious":{"status":false},"disqus":{"status":false},"fbshare":{"status":false},"flattr":{"status":false},"hackernews":{"status":false},"linkedin":{"status":false},"mail":{"status":false},"stumbleupon":{"status":false},"tumblr":{"status":false},"xing":{"status":false}, "pinterest":{"status":false}}}</script>
<div class="row">
  <div class="col-md-8">
    <h1 class="fancy">Vim hotkey to run current file depending on the filetype</h1>

    <div class="post-date fancy">
      March 11, 2013
    </div>
    <br />

    <p>So, here&rsquo;s the thing, you&rsquo;re editing a file and you need to run it. And, since
you are in vim, you might want to be clever and do something like
<code>:map &lt;F5&gt; :!ruby %&lt;cr&gt;</code> on the fly. But, you can&rsquo;t ever be clever enough in vim.</p>

<p><a href="http://vimdoc.sourceforge.net/htmldoc/autocmd.html">Autocmd</a> is a feature of vim which allows to execute a command when an
event occurs. In our context, we need vim to map a key to execute the current
file in ruby if it is a ruby script. All we need is to add the following statement
to <code>.vimrc</code>:</p>

<pre><code>autocmd FileType ruby nmap &lt;F5&gt; :!ruby %&lt;cr&gt;
</code></pre>

<p>This means that when the &ldquo;FileType&rdquo; variable in vim will be set to ruby, the
key <code>F5</code> will be mapped to run current file with ruby. This is very convenient
because usually that variable is set by syntax detectors.</p>

<p>Then, we can extend this and add new file types:</p>

<pre><code>autocmd FileType ruby nmap &lt;F5&gt; :!ruby %&lt;cr&gt;
autocmd FileType coffee nmap &lt;F5&gt; :!coffee %&lt;cr&gt;
</code></pre>

<p>Neat, huh? Based on the file type, vim will execute the current file in the
corresponding interpreter.</p>

<h3>Taking it a bit further</h3>

<p>Also, it would be nice to save the file each time you want to run it, and also
measure the time it took to run. For that, you will need a function:</p>

<pre><code>function RunWith (command)
  execute "w"
  execute "!clear;time " . a:command . " " . expand("%")
endfunction

autocmd FileType coffee nmap &lt;F5&gt; :call RunWith("coffee")&lt;cr&gt;
autocmd FileType ruby   nmap &lt;F5&gt; :call RunWith("ruby")&lt;cr&gt;
</code></pre>

<p><code>RunWith</code> is a function which accepts the executable name which will be used to
execute the current file. It will save the file before executing it, and will
clear the console screen.</p>

<p><strong>Pro tip:</strong> auto map a rspec run hotkey.</p>

<pre><code>autocmd BufRead *_spec.rb nmap &lt;F6&gt; :w\|!clear &amp;&amp; rspec % --format documentation --color&lt;cr&gt;
</code></pre>

<p>(each time a file with <code>_spec.rb</code> is loaded, the editor will map the <code>F6</code> key
to execute the rspec on the current file)</p>


    <br />

    <section class="meta">
      <div data-social-share-privacy='true'></div>
      <hr />
      <div id="disqus_thread"></div>

      <script type="text/javascript">
          /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
          var disqus_shortname = 'alisnic-github'; // required: replace example with your forum shortname

          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
      </script>
    </section>
  </div>
</div>

            </div>
          </div>
        </div>
      </div>
    </div>

  <script src='/assets/global-65d9c526b0661a1f42c26a513b3bb72a.js' type='text/javascript'></script>


  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37064536-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>

</body>
</html>
