<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <title>Log filename, line and function name in ruby automatically</title>
  <meta name="author" content="Andrei Lisnic" />
  <meta name="description" content="a (instanceof) lisnic." />
  <link rel="alternate" type="application/rss+xml" href="/atom.xml" />
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png" />
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">

<link href='/assets/global-ed12576ac2a8c45d153e3d7049e3d321.css' rel='stylesheet' type='text/css' />

</head>

<body>
  <div id="wrapper">
      <!-- Sidebar -->
      <div id="sidebar-wrapper">
        <div id="avatar"></div>
        <ul class="sidebar-nav">
          <li><a href="#"><b>Andrei Lisnic</b></a></li>
          <li><a href="/" >All posts</a></li>
          <li><a href="https://github.com/alisnic" >github</a></li>
          <li><a href="https://twitter.com/andrei_lisnic" >twitter</a></li>
          <li><a href="http://www.linkedin.com/in/alisnic" >linkedin</a></li>
          <li><a href="/atom.xml" >rss</a></li>
          <li><a href="#"><b>Projects</b></a></li>
          <li><a href="/nyny/">New York, New York</a></li>
        </ul>
      </div>

      <!-- Page content -->
      <div id="page-content-wrapper">
        <div class="page-content inset">
          <div class="row">
            <div class="col-md-12">
              <script type="application/x-social-share-privacy-settings">{"path_prefix":"http://panzi.github.io/SocialSharePrivacy/","layout":"line","services":{"buffer":{"status":false},"delicious":{"status":false},"disqus":{"status":false},"fbshare":{"status":false},"flattr":{"status":false},"hackernews":{"status":false},"linkedin":{"status":false},"mail":{"status":false},"stumbleupon":{"status":false},"tumblr":{"status":false},"xing":{"status":false}, "pinterest":{"status":false}}}</script>
<div class="row">
  <div class="col-md-8">
    <h1 class="fancy">Log filename, line and function name in ruby automatically</h1>

    <div class="post-date fancy">
      May 11, 2013
    </div>
    <br />

    <p>Suppose you have a app with a logger:</p>

<pre><code>require 'logger'

module MyApp
  Log = Logger.new(STDOUT)

  class Foo
    def self.hello
      Log.info "test message"
    end
  end
end

MyApp::Foo.hello
</code></pre>

<p>When you run it, everything is as usual:</p>

<pre><code>I, [2013-05-11T21:26:40.701590 #4326]  INFO -- : test message
</code></pre>

<p>Now imagine you have a ton of such messages flooding the output. Wouldn&rsquo;t be
nice if the logger would also include the filename, the line and the function
name where the Log output was issued? Well, you can do that in ruby:</p>

<pre><code>require 'logger'

module MyApp
  Log = Logger.new(STDOUT)
  Log.formatter = proc { |severity, datetime, progname, msg|
    "#{severity} #{caller[4]} #{msg}\n"
  }

  class Foo
    def self.hello
      Log.info "test message"
    end
  end
end

MyApp::Foo.hello
</code></pre>

<p>If we will run this, we&rsquo;ll see the following output:</p>

<pre><code>INFO log_test.rb:14:in `hello': test message
</code></pre>

<h1>How it is done</h1>

<p>Ruby has a magic array &ndash; <code>caller</code>. It contains the ordered list of the files, lines,
and functions being executed.</p>

<pre><code>class Foo
  def self.baz
    hello
  end

  def self.hello
    p caller
  end
end

Foo.baz #=&gt; ["/home/andrei/Temp/log_test.rb:21:in `baz'", "/home/andrei/Temp/log_test.rb:29:in `&lt;main&gt;'"]
</code></pre>

<p>We used that magic array for our logger formatter, and we used its 4th element
because the code which calls the logger is 4 levels above in call stack relative
to formatter proc.</p>

<p><strong>Note</strong>: If you use a different version of logger, you might need to use a
different number, not 4. In any case, inspect the caller array and see at which
position in that array your code info is located.</p>


    <br />

    <section class="meta">
      <div data-social-share-privacy='true'></div>
      <hr />
      <div id="disqus_thread"></div>

      <script type="text/javascript">
          /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
          var disqus_shortname = 'alisnic-github'; // required: replace example with your forum shortname

          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
      </script>
    </section>
  </div>
</div>

            </div>
          </div>
        </div>
      </div>
    </div>

  <script src='/assets/global-65d9c526b0661a1f42c26a513b3bb72a.js' type='text/javascript'></script>


  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37064536-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>

</body>
</html>
