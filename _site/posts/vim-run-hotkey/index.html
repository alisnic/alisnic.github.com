<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width; initial-scale=1.0, maximum-scale=1">
    <link href="http://gmpg.org/xfn/11" rel="profile">

    <title>
      Andrei Lisnic
    </title>

    <!-- CSS -->
    <link rel="stylesheet" href="/public/css/hyde.css">
    <link rel="stylesheet" href="/public/css/pygments.css">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:300,400italic,400,600,700|Abril+Fatface">

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
  </head>
  <body>

    <header class="masthead">
      <div class="masthead-inner">
        <h1><a href="/">Andrei Lisnic</a></h1>
        <ul>
          <li><a href="https://github.com/alisnic" >github</a></li>
          <li><a href="https://twitter.com/andrei_lisnic" >twitter</a></li>
          <li><a href="http://www.linkedin.com/in/alisnic" >linkedin</a></li>
          <li><a href="/atom.xml" >rss</a></li>
        </ul>
        <h3>Projects</h3>
        <ul>
          <li><a href="/nyny/">New York, New York</a></li>
        </ul>
      </div>
    </header>

    <div class="content container">
      <div class="post">
  <h1>Vim hotkey to run current file depending on the filetype</h1>
  <span class="post-date">11 Mar 2013</span>
  <p>So, here&#39;s the thing, you&#39;re editing a file and you need to run it. And, since
you are in vim, you might want to be clever and do something like
<code>:map &lt;F5&gt; :!ruby %&lt;cr&gt;</code> on the fly. But, you can&#39;t ever be clever enough in vim.</p>

<p><a href="http://vimdoc.sourceforge.net/htmldoc/autocmd.html">Autocmd</a> is a feature of vim which allows to execute a command when an
event occurs. In our context, we need vim to map a key to execute the current
file in ruby if it is a ruby script. All we need is to add the following statement
to <code>.vimrc</code>:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">autocmd FileType ruby nmap &lt;F5&gt; :!ruby %&lt;cr&gt;
</code></pre></div>
<p>This means that when the &quot;FileType&quot; variable in vim will be set to ruby, the
key <code>F5</code> will be mapped to run current file with ruby. This is very convenient
because usually that variable is set by syntax detectors.</p>

<p>Then, we can extend this and add new file types:</p>
<div class="highlight"><pre><code class="vim language-vim" data-lang="vim">autocmd <span class="nb">FileType</span> <span class="k">ruby</span> nmap <span class="p">&lt;</span>F5<span class="p">&gt;</span> :<span class="p">!</span><span class="k">ruby</span> %<span class="p">&lt;</span><span class="k">cr</span><span class="p">&gt;</span>
autocmd <span class="nb">FileType</span> coffee nmap <span class="p">&lt;</span>F5<span class="p">&gt;</span> :<span class="p">!</span>coffee %<span class="p">&lt;</span><span class="k">cr</span><span class="p">&gt;</span>
</code></pre></div>
<p>Neat, huh? Based on the file type, vim will execute the current file in the
corresponding interpreter.</p>

<h3>Taking it a bit further</h3>

<p>Also, it would be nice to save the file each time you want to run it, and also
measure the time it took to run. For that, you will need a function:</p>
<div class="highlight"><pre><code class="vim language-vim" data-lang="vim"><span class="k">function</span> RunWith <span class="p">(</span>command<span class="p">)</span>
  execute <span class="s2">&quot;w&quot;</span>
  execute <span class="s2">&quot;!clear;time &quot;</span> . <span class="k">a</span>:command . <span class="s2">&quot; &quot;</span> . expand<span class="p">(</span><span class="s2">&quot;%&quot;</span><span class="p">)</span>
<span class="k">endfunction</span>

autocmd <span class="nb">FileType</span> coffee nmap <span class="p">&lt;</span>F5<span class="p">&gt;</span> :<span class="k">call</span> RunWith<span class="p">(</span><span class="s2">&quot;coffee&quot;</span><span class="p">)&lt;</span><span class="k">cr</span><span class="p">&gt;</span>
autocmd <span class="nb">FileType</span> <span class="k">ruby</span>   nmap <span class="p">&lt;</span>F5<span class="p">&gt;</span> :<span class="k">call</span> RunWith<span class="p">(</span><span class="s2">&quot;ruby&quot;</span><span class="p">)&lt;</span><span class="k">cr</span><span class="p">&gt;</span>
</code></pre></div>
<p><code>RunWith</code> is a function which accepts the executable name which will be used to
execute the current file. It will save the file before executing it, and will
clear the console screen.</p>

<p><strong>Pro tip:</strong> auto map a rspec run hotkey.</p>
<div class="highlight"><pre><code class="vim language-vim" data-lang="vim">autocmd <span class="nb">BufRead</span> *_spec.rb nmap <span class="p">&lt;</span>F6<span class="p">&gt;</span> :<span class="k">w</span>\<span class="p">|!</span>clear &amp;&amp; rspec % <span class="p">--</span>format documentation <span class="p">--</span><span class="k">color</span><span class="p">&lt;</span><span class="k">cr</span><span class="p">&gt;</span>
</code></pre></div>
<p>(each time a file with <code>_spec.rb</code> is loaded, the editor will map the <code>F6</code> key
to execute the rspec on the current file)</p>

</div>

<div>
  <h3>Related Posts</h3>
  <ul class="related-posts">
    
      <li>
        <h4>
          <a href="/posts/ruby-logs">
            Log filename, line and function name in ruby automatically
            <small>11 May 2013</small>
          </a>
        </h4>
      </li>
    
      <li>
        <h4>
          <a href="/posts/unity-fly">
            Unity performance tweaks
            <small>20 Mar 2013</small>
          </a>
        </h4>
      </li>
    
      <li>
        <h4>
          <a href="/posts/rails-prototyping">
            Fast Rails app prototyping
            <small>23 Jan 2013</small>
          </a>
        </h4>
      </li>
    
  </ul>
</div>


<section class="meta">
  <div data-social-share-privacy='true'></div>
  <hr />
  <div id="disqus_thread"></div>

  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'alisnic-github'; // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
</section>


    </div>

    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-37064536-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </body>
</html>
